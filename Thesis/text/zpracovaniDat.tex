\chapter{Zpracování dat}
Vytvořené zařízení inerciální jednotky poskytuje poměrně velké množství dat které je možné různě zpracovávat. Kromě samotných dat z dvou IMU také zaznamenává měřené hodnoty z elektronického kompasu a GNSS modulu. V průběhu vypracování práce se ukázalo, že zpracovat data tak, abychom dosáhli uspokojivých výsledků není vůbec jednoduché a zasloužilo by si samo o sobě rozsah další práce. V této kapitole budou popsány zejména dva postupy zpracování měření, a to výpočet trajektorie čistě z pohybových rovnic a fůze dat s GNSS. Později bylo také zjištěno, že navigace čistě z inerciálních dat nedosahuje uspokojivých výsledků a je zapotřebí korekce dat z GNSS, který ovšem má často ve vnitřních prostorech velmi špatné pokrytí.

Všechny níže popsané skripty byly vytvořené v prostředí MATLAB, jelikož je v něm manipulace s vektory a maticemi jednoduchá. Také můžeme využít již hotových modelů chování senzorů a implementovaných filtrů z Navigation Toolboxu, který je stále poměrně rozsáhle rozšiřován. V elektronické příloze jsou kromě skriptů dostupná i vzorová naměřená data, převedena do formátu csv, které je možné použít k experimentování. Obsahují například chůzi napříč budovou a místností, jízdu autem na venkovním prostranství a měření jednotky v klidu.

\section{Výpočet trajektorie pomocí pohybových rovnic} \label{noFiltProcessing}
Jedná se o základní způsob zpracování dat, který byl popsán v kapitole \ref{INSalg}, které lze nejlépe vystihnout obrázkem  \ref{StrapdownBlock}. Nejdříve je vypočteno z prvního vzorku zrychlení natočení celého zařízení vůči zemi, tedy směr tíhového vektoru. Z tohoto důvodu je potřeba, aby zařízení bylo při začátku měření nepohyblivé. Následně jsou data z gyroskopu integrována numerickou lichoběžníkovou metodou, abychom získali změnu orientace jednotky, ke kterému je přičten výchozí stav.

Z těchto úhlů natočení je vypočtena rotační matice, pomocí které otočíme měřená data zrychlení z body framu do earth framu. Z tohoto rotovaného zrychlení je následně odečten vektor tíhového zrychlení a pomocí dvou dalších numerických integrací otočeného zrychlení vypočteme odhad trajektorie.

Pro demonstraci tohoto postupu byla vytvořena vzorová data chůze ve tvaru obdélníku o rozměrech 3,5 a 4 m. Na začátku a konci těchto měření byla jednotka položena nehybně na stole.

\begin{figure}[h]
     \centering
     \begin{subfigure}[b]{0.49\textwidth}
         \centering
         \includegraphics[width=\textwidth]{obrazky/matlab/1measAngularVel}
         \caption{Data z akcelerometru}     
     \end{subfigure}
     \hfill
     \centering
     \begin{subfigure}[b]{0.49\textwidth}
         \centering
         \includegraphics[width=\textwidth]{obrazky/matlab/1measAccel}
         \caption{Data z gyroskopu}   
     \end{subfigure}

        \caption{Záznam dat IMU ADIS16505}
        \label{fig:IMURawData}
\end{figure}

Na obrázku \ref{fig:IMURawData} jsou vidět nezpracovaná zaznamenaná data. Úhlová rychlost v ose Z obsahuje výrazné špičky, jedná se o otáčení v rozích pomyslného čtverce. Na datech akcelerometru je vidět, že celý čas měření byla jednotka převážně ve vodorovné pozici, jelikož lineární zrychlení v ose Z představuje tíhové zrychlení. Zákmity ve zrychlení jsou způsobeny kroky chůze.

\begin{figure}[h]
     \centering
     \begin{subfigure}[b]{0.49\textwidth}
         \centering
         \includegraphics[width=\textwidth]{obrazky/matlab/1measOrient}
         \caption{Natočení jednotky}   
         \label{fig:Rotation}  
     \end{subfigure}
     \hfill
     \centering
     \begin{subfigure}[b]{0.49\textwidth}
         \centering
         \includegraphics[width=\textwidth]{obrazky/matlab/1measAccelEframeWithoutG}
         \caption{Zrychlení v e-frame bez tíhového.}   
         \label{fig:AccelWithoutG}  
     \end{subfigure}

        \caption{Výsledky po první integraci}
        \label{fig:rotationAccel}
\end{figure}

Po integraci dat úhlové rychlosti můžeme určit natočení jednotky (znázorněno na obrázku \ref{fig:Rotation} ) a rotovat vektory zrychlení do e-frame. Po odečtení tíhového zrychlení z osy Z dostaneme data na obrázku \ref{fig:AccelWithoutG}.

Na obou grafech z obrázku \ref{fig:rotationAccel} je patrně vidět problém čistě inerciální navigace, kde na konci měření není zrychlení, nebo natočení v osách X a Y nulové. To je způsobené kumulováním chyby při integraci dat. Toto bývá označováno jako gyro drift. Často jsou chyby potlačovány použitím kalmanova filtru, kde je drift gyroskopu kompenzován dlouhodobým měřením směru tíhového zrychlení, což je vhodné pro případ, že by naším cílem bylo určit pouze náklon v prostoru. Ovšem vzhledem k tomu, že použití filtrů přináší časovou prodlevu v ustálení měření orientace, tak jsou data akcelerometru stále krátkodobě natáčena ve špatném směru, což po následné integraci na rychlost a trajektorii stále přináší velkou chybu.

Po následných dvou numerických integrací zrychlení můžeme výslednou trajektorii reprezentovat v 3D prostoru obrázkem \ref{fig:Trajectory}, kde je v počátku mírně vidět tendence chůze v přímce, ale poté nastává integrací chyby úplné znehodnocení dat. 

\begin{figure}[h]
     \centering
         \includegraphics[width=0.5\textwidth]{obrazky/matlab/1measTraj}
         \caption{Odhad trajektorie}
        \label{fig:Trajectory}
\end{figure}

\section{Vliv kalibrace senzorů}
Za krátkou zmínku stojí i porovnání vlivu kalibrace senzorů na výsledná data. Na to můžeme použít skript z kapitoly \ref{noFiltProcessing}. Přestože odhad trajektorie nemá moc velkou vypovídající hodnotu, tak přesnost senzorů můžeme alespoň částečně posoudit například tím, jak moc se změřené zrychlení v e-framu s odečteným tíhovým zrychlením na konci měření když je zařízení v klidu odchyluje od nuly. Byla provedena dvě obdobná měření při chůzi s jednotkou trajektorie stejného tvaru z předchozí kapitoly, bez kalibrace a s kalibrací.

\begin{figure}[h]
     \centering
     \begin{subfigure}[b]{0.49\textwidth}
         \centering
         \includegraphics[width=\textwidth]{obrazky/matlab/1adisNoCal}
         \caption{ADIS16505 bez kalibrace}   
         \label{fig:adisNoCal}  
     \end{subfigure}
     \hfill
     \centering
     \begin{subfigure}[b]{0.49\textwidth}
         \centering
         \includegraphics[width=\textwidth]{obrazky/matlab/1mpuNoCal}
         \caption{MPU6050 bez kalibrace}   
         \label{fig:mpuNoCal}  
     \end{subfigure}
     
     
     \centering
     \begin{subfigure}[b]{0.49\textwidth}
         \centering
         \includegraphics[width=\textwidth]{obrazky/matlab/1adisWithCal}
         \caption{ADIS16505 s kalibrací}   
         \label{fig:AdisWithCal}  
     \end{subfigure}
     \hfill
     \centering
     \begin{subfigure}[b]{0.49\textwidth}
         \centering
         \includegraphics[width=\textwidth]{obrazky/matlab/1mpuWithCal}
         \caption{MPU6050 s kalibrací}   
         \label{fig:mpuWithCal}  
     \end{subfigure}
        \caption{Porovnání senzorů s kalibrací a bez kalibrace}
        \label{fig:calibrationComp}
\end{figure}

Na obrázku \ref{fig:calibrationComp} můžeme vidět porovnání dvou měření se zpracovanými daty z obou IMU. ADIS16505 dosahuje na konci měření maximální odchylku zrychlení zhruba $ \SI[per-mode = symbol]{2}{\metre\per\second\squared} $ s i bez kalibrace. To odpovídá tomu, že se jedná o poměrně přesný a nákladný senzor. Po kalibraci jsou totiž konstanty gainu pro všechny osy akcelerometru většinou řádově rovny 0,99990 a lepší, není jej potřeba tedy téměř kalibrovat. Situace je ovšem jiná u IMU MPU6050, které bez kalibrace dosahuje dvojnásobné odchylky od ADIS16505, zatímco po kalibraci je jeho odchylka zhruba srovnatelná s přesnějším senzorem.

Z tohoto můžeme usoudit, že i takto poměrně jednoduchá metoda kalibrace má poměrně dost pozitivní dopady na výsledky měření levnějších IMU.

\section{Fůze dat s GNSS}
Na fůzi


